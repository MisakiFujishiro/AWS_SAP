# コスト最適化
## EC2のコスト

### Reserved Instance
1年、または3年の購入期間が必要。
支払いは前払いや毎月払いができる。

購入の際に対象のインスタンスタイプとRI数を指定する。
特定のインスタンスが無料で起動できるのはなく、対象となるインスタンスタイプのインスタンスが起動していると利用されていく。  
※正規化係数は、各インスタンスタイプに割り振られた値

無料枠全量の考え方は以下
> 購入インスタンスタイプの正規化係数 * RI数 * 365 * 24

利用される無料枠の考え方は以下
> 利用されているディスカウント対象のインスタンスタイプの正規化係数 * RI数 * 時間

#### 提供クラス
スタンダートとコンバーティブルから選択することができる。

スタンダートは、同じインスタンスファミリー内での変更が可能。ただし正規化係数が一致している必要がある。
コンバーティブルは、インスタンスファミリーについても変更が可能。ただし同等か上のレベルのみ適用可能。


### Savings Plan
Reserved Instanceと比較して、事前に決定することが少ない中でディスカウントを受けることができるメリットがある。
例えば、インスタンスタイプやリージョン、OSを選択することなく、割り引きを始めることができる。


### スポットインスタンス
各AZのインスタンスタイプの使用されていない量に応じて決定される料金で利用することができる。
ただし、使用量が上がってきた場合は、中断されてしまう可能性がある。

なので、中断が発生してもAppに影響がないようなユースケースで利用すること。


### Dedicated Hosts
専用の物理サーバーを確保してEC2インスタンスを起動させることができる。ライセンス要件にまで対応できる。
追加の料金がかかるが、こちらについてもリザーブドインスタンスを指定することができる。

類似サービスのハードウェア専有はインスタンスの配置がコントロールできないなど、Dedicated Hostsの方がより専有の要件を満たしてリウ。
ライセンス要件にも対応したい場合はDedicated Hostsで、専用物理サーバーの要件に答えるだけならハードウェア専有インスタンスが適切。



## S3のコスト
S3の一覧

| 種類 | 耐久性 | 速度 | 特徴 |
|:------|:-------:|------:|------:|
| S3標準     | 3つのAZ       | 高スループット、低レイテンシー     | 標準     |
| S3 標準 – IA     | 3つのAZ       | 高スループット、低レイテンシー     | アクセスが少ない場合料金が安い     |
| S3 Intelligent-Tiering      | 3つのAZ       | 高スループット、低レイテンシー     | 自動でIAと標準を使い分ける     |
| S3 1 ゾーン – IA     | 1つのAZ       | 高スループット、低レイテンシー      | 可用性を落として費用を削減     |
| S3 Glacier Instant Retrieval     | 1つのAZに障害が発生しても復元可能       | 高スループット、低レイテンシー     | アクセスがほとんど無いがミリ秒単位のアクセスが必要     |
| S3 Glacier Flexible Retrieval (旧 S3 Glacier)     | 1つのAZに障害が発生しても復元可能       | 数分から数時間のアクセス時間     | ほぼ利用されないデータで即時性が求められないもの     |
| Amazon S3 Glacier Deep Archive     | 3つのAZ       | 取り出し時間は 12 時間以内     | 7～10 年以上データセットを保管するように設計     |

### S3 標準 vs IA
IAは保管費用が安い分、アクセス時のお金はかかる。
1ヶ月に1度なら、標準の方補が安い。

### S3 Intelligent-Tiering 
30日利用がないとIAへ、90日利用がないとアーカイブへ移動してくれる。

### S3リクエスタ支払い
S3へのリクエストした側にリクエスト料金とデータ転送料金を請求することができる。

支払いが関連するのでAWSアカウントからしかアクセスできなくなる。
リクエストヘッダーに必ず`x-amz-request-payer`を追加する必要があり、このリクエストヘッダーを持って支払いに了承したとして扱う。



## DynamoDBのこすと
### オンデマンドモード
### プロビジョンどキャパシティモード
### DAX




## その他
### リザーブドオプション
### コスト配分タグ


## コスト管理
### AWS Compute Optimizer
### Cost Explorer
### Anomaly Detection
### AWS Cost and Usage Reports
### AWS Budgets
### 請求アラーム